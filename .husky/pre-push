#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "üîç Running pre-push checks..."

# Check if we're pushing to protected branches
branch=$(git rev-parse --abbrev-ref HEAD)

if [ "$branch" = "master" ]; then
  echo "‚ùå Direct push to master is not allowed!"
  echo "Please create a Pull Request instead."
  exit 1
fi

# TypeScript type check (backend)
echo "üîç Checking TypeScript types (backend)..."
cd backend && npm run build 2>/dev/null
if [ $? -ne 0 ]; then
  echo "‚ùå Backend TypeScript errors found!"
  echo "Fix TypeScript errors before pushing."
  cd ..
  exit 1
fi
cd ..

# TypeScript type check (frontend)
echo "üîç Checking TypeScript types (frontend)..."
cd frontend && npm run build 2>/dev/null
if [ $? -ne 0 ]; then
  echo "‚ùå Frontend TypeScript errors found!"
  echo "Fix TypeScript errors before pushing."
  cd ..
  exit 1
fi
cd ..

echo "‚úÖ All pre-push checks passed!"
